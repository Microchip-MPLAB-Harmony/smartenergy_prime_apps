<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="concept" />
<meta name="DC.title" content="Last Data Communication with a Node" />
<meta name="DC.relation" scheme="URI" content="GUID-66762CCC-9D4D-406B-94FD-EB2C7F863A64.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>Last Data Communication with a Node</title>
<meta name="Microsoft.Help.Id" content="GUID-B0EED1DD-60EE-41BF-A319-00EF8C6E51CB-GUID-2ADC0446-33A7-4D75-BB69-6487C6367907" />
<meta name="Microsoft.Help.TocParent" content="GUID-B0EED1DD-60EE-41BF-A319-00EF8C6E51CB-GUID-66762CCC-9D4D-406B-94FD-EB2C7F863A64" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB® Harmony Smart Energy PRIME Applications Reference A 04/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-2ADC0446-33A7-4D75-BB69-6487C6367907"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907">

<h1 class="title topictitle1" id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907__GUID-3DCC5E9C-82A3-4D0F-8AE3-ABEBAEAF7683">Last Data Communication with a Node</h1>
<div class="body conbody">
        <p class="p" id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907__ID-00000517">In this case, we will need to join information from Frame and MeshHeader
            tables. Mesh Header contains information based on short address, first we need to find
            out the short address assigned to a node as shown before.</p>

        <pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d2965e19', this);">Copy</button><code id="d2965e19" content="SELECT * FROM Frame,MeshHeader WHERE idframe=MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005'))">SELECT * FROM Frame,MeshHeader WHERE idframe=MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005'))</code></pre>
        <p class="p" id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907__ID-00000519">This statement queries all frames that have a Mesh Header where origin
            or destination is the selected node. If it is needed only the last frame, then it is
            needed to add the <em class="ph i">“ORDER BY idFrame DESC”</em> clause and <em class="ph i">LIMIT</em> the search to
            one row:</p>

        <pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d2965e31', this);">Copy</button><code id="d2965e31" content="SELECT * FROM Frame,MeshHeader WHERE idframe=MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005')) ORDER BY idframe DESC LIMIT 1">SELECT * FROM Frame,MeshHeader WHERE idframe=MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005')) ORDER BY idframe DESC LIMIT 1</code></pre>
        <p class="p" id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907__ID-0000051D">Mesh Header can contain addresses in the form EUI64, therefore, the
            field has a type of BLOB. To select by these fields, data must by entered in hexadecimal
            format: <em class="ph i">X’----’</em>.</p>

        <p class="p" id="GUID-2ADC0446-33A7-4D75-BB69-6487C6367907__ID-0000051F">It is possible to add results from different select statements to get,
            for example, all messages for a node, including route request/responses:</p>

        <pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d2965e44', this);">Copy</button><code id="d2965e44" content="SELECT Frame.* FROM FRAME,MeshHeader where idframe = MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005'))&#xA;UNION&#xA;SELECT Frame.* FROM Frame,RREQ WHERE (RREQ.Originator = 5 OR RREQ.Destination = 5) and RREQ.RREQ_idFrame = Frame.idFrame&#xA;UNION&#xA;SELECT Frame.* FROM Frame,RREP WHERE (RREP.Originator = 5 OR RREP.Destination = 5) and RREP.RREP_idFrame = Frame.idFrame">SELECT Frame.* FROM FRAME,MeshHeader where idframe = MeshHeader_idframe and ((OriginatorAddress = X'0005' and DestinationAddress = X'0000') OR (OriginatorAddress = X'0000' and DestinationAddress = X'0005'))
UNION
SELECT Frame.* FROM Frame,RREQ WHERE (RREQ.Originator = 5 OR RREQ.Destination = 5) and RREQ.RREQ_idFrame = Frame.idFrame
UNION
SELECT Frame.* FROM Frame,RREP WHERE (RREP.Originator = 5 OR RREP.Destination = 5) and RREP.RREP_idFrame = Frame.idFrame</code></pre>
    </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-66762CCC-9D4D-406B-94FD-EB2C7F863A64.html">Sample SQLite Filters</a></div>
</div>
</div></body>
</html>